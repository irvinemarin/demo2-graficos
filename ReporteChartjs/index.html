<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportes Gerencial de la Corte Suprema</title>

    <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300" rel="stylesheet"/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css?family=Kanit" rel="stylesheet"/>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>

<body>
<main>


    <div style="display: flex">
        <img src="assets/logo-pj.png" style="height: 50px" alt="">
        <h1 style="
        font-size: 25px;
        text-align: center; width: 65%"> Reportes Gerencial de la Corte Suprema
            <br><span>Visualización de estadísticas </span>
        </h1>

    </div>
    <div id="fondoPJ"></div>
    <hr>

    <div
            class="leftPanel no-print " id="leftPanel">
        <div class="contentBackground">
            <h5>Reportes Disponibles</h5>
            <div class="listaReportes" id="listaReportesDIV">
                <div class="item-report " onclick="onCLickItemReporteListenerListener('1','REPORTE DE INGRESOS',this)">
                    <p>REPORTE DE INGRESOS </p>
                </div>
                <div class="item-report item2"
                     onclick="onCLickItemReporteListenerListener('2','REPORTE PROGRAMADOS',this)">
                    <p>REPORTE PROGRAMADOS</p>
                </div>
                <div class="item-report item3"
                     onclick="onCLickItemReporteListenerListener('3','REPORTE ESCRITOS',this)">
                    <p>REPORTE ESCRITOS</p>
                </div>
            </div>
        </div>
    </div>
    <div style="
    opacity: .4;
    background-color: #575757;
    width: 100%; height: 100% ;position: fixed; top: 0px; display: none "

         id="spinnerGrafico" class="justify-content-center">
        <div style="position: absolute; left: 30%; top : 45%;">
            <p style="
            border-radius: 10px;
            font-size: 25px; background-color: #000000">Espere un momento esto puede tardar un poco...</p>

            <div class="spinner-border text-primary " style="width: 5rem; height: 5rem;" role="status">
                <!--                Loading-->
                <!--                <span class="sr-only">Loading...</span>-->
            </div>
        </div>


    </div>

    <div class="initPanel no-print">

        <!--        <img style="width: 100%!important;" src="assets/Palacio_solo.jpg" alt="">-->
        <div class="overlayInit"></div>
    </div>

    <div class="mainPanel" style="display: none" id="mainPanelDiv">


        <div style="right: 0;position: absolute">
            <button type="button" class="btn btn-primary no-print" onclick="print()">IMPRIMIR</button>
        </div>

        <h2 class="loading">Espere un momento ...</h2>
        <br>
        <br>
        <div class="row">

            <div class="col-sm-4 col-md-3 no-print" style="">
                <label for="selectableAnio">Tipo Grafico </label>
                <BR>
                <select class="custom-select"
                        name="selectableAnio" id="comboGrafico">
                    <option value="bar">Barras</option>
                    <option value="line">Lineas</option>
                    <!--                <option value="pie">Circular</option>-->

                </select>
            </div>
            <div class=" form-group col-md-3 col-sm-12" id="Content_fInicio">
                <label for="fInicio">Fecha Inicio</label>
                <input type="date" class="form-control" id="fInicio" aria-describedby="emailHelp"
                       placeholder="">
                <!--                <small id="fInicioHelp" class="form-text text-muted">-->
                <!--                    We'll never share your email with anyone else.</small>-->
            </div>

            <div class=" form-group col-md-3 col-sm-12" id="Content_fFin">
                <label for="fFin">Fecha fin</label>
                <input type="date" class="form-control" id="fFin" aria-describedby="emailHelp"
                       placeholder="">
                <!--                <small id="fFinHelp" class="form-text text-muted">-->
                <!--                    We'll never share your email with anyone else.</small>-->
            </div>
            <div class="col-md-3 col-sm-12">
                <label style="color: white">-</label>
                <a
                        id="btnBuscar"
                        style="color: white !important; "
                        onclick="
                               onClickBuscarListener();"
                        class="shadow1 col-12 btn btn-primary">Buscar
                </a>
            </div>

        </div>


        <section id="content01" class="col-11">
            <figure>

                <div class="container-title">
                    <h3 id="tituloReporte1"></h3>
                </div>
                <div id="Contentchart7">
                    <canvas id="chart7"></canvas>
                </div>

            </figure>
        </section>

        <section
                id="content02" class="col-11">
            <figure>

                <div class="container-title">
                    <h3 id="tituloReporte2"></h3>
                </div>

                <div id="Contentchart72">
                    <canvas id="chart72"></canvas>
                </div>
            </figure>
        </section>

        <section id="content03" class="col-11">
            <figure>

                <div class="container-title">
                    <h3 id="tituloReporte3"></h3>
                </div>
                <div id="Contentchart73">
                    <canvas id="chart73"></canvas>
                </div>
            </figure>
        </section>


        <div class="row">
            <h3 id="tituloSalaFiltro" class="col-4"></h3>
            <div class="col-md-2 col-sm-12" style="display: block;">
                <div id="tablaContent01" style="">

                    <label for="selectableAnio">FILTRO AÑO</label>
                    <BR>
                    <select class="custom-select" name="selectableAnio" id="selectableAnio">
                        <option value=""></option>
                    </select>
                </div>
            </div>
            <div class="col-md-2 col-sm-12">
                <div id="tablaContent02"
                     style="display: block;">
                    <label for="selectableFiltroSala">FILTRO SALAS</label>
                    <BR>
                    <select
                            class="custom-select"
                            name="selectableFiltroSala" id="selectableFiltroSala">
                        <option value=""></option>
                    </select>
                </div>
            </div>

        </div>

        <div class="row">
            <div id="DIV_filtrosFecha" class="col-sm-12  col-md-8 col-xl-4 ml-auto">
                <div class="row">

                </div>
            </div>
        </div>

        <div class="row">
            <!--*************************************-->
            <div style="width: 100%!important; ;">


                <div class="row">
                    <div class="col-6">

                        <figure id="figureContent01">
                            <div>
                                <!--                        <button onclick="loadGraficoDetalle('01')">GRAFICAR TABLA</button>-->

                                <label
                                        id="label_selectable01"
                                        for="selectable01"> </label>
                                <BR>
                                <select name="selectable01" id="selectable01">
                                    <option value=""></option>
                                </select>
                            </div>
                            <div id="spinner01" class="justify-content-center">
                                <p>Cargando Información...</p>
                                <div class="spinner-border text-primary" role="status">
                                    <span class="sr-only">...</span> <!-- Loading -->
                                </div>
                            </div>
                            <div
                                    class="txtInformacionFiltro"

                                    id="txtInformacionFiltro01">txtInformacionFiltro02
                            </div>
                            <BR>
                            <table class="greyGridTable" id="table01" style="background-color: #ffffff; width: 100%;">
                                <thead>
                                <tr id="headerTable01">
                                </tr>
                                </thead>
                                <tbody id="bodyTable01">
                                </tbody>
                            </table>
                        </figure>
                        <p id="txtResultado01" style="display: none">Sin resultados.</p>
                    </div>
                    <div class="col-6 "
                         style="background-color: #ffffff; position: absolute !important; right: -80px !important; ">
                        <figure
                                id="figureContent02"
                                class="col-12">
                            <div>
                                <!--                        <button onclick="loadGraficoDetalle('02')">GRAFICAR TABLA</button>-->

                                <label id="label_selectable02" for="selectable02"></label>
                                <BR>
                                <select name="selectable02" id="selectable02">
                                    <option value=""></option>
                                </select>
                            </div>

                            <div id="spinner02" class=" justify-content-center">
                                <p>Cargando Información</p>

                                <div class="spinner-border text-primary" role="status">
                                    <span class="sr-only">...</span>  <!-- Loading -->
                                </div>
                            </div>
                            <div
                                    class="txtInformacionFiltro"
                                    id="txtInformacionFiltro02">txtInformacionFiltro02
                            </div>
                            <BR>
                            <table class="greyGridTable" id="table02" style=" width: 100%!important;">
                                <thead>
                                <tr id="headerTable02">
                                </tr>
                                </thead>
                                <tbody id="bodyTable02">
                                </tbody>
                            </table>
                        </figure>
                        <p id="txtResultado02" style="display: none">Sin resultados.</p>

                    </div>

                </div>
            </div>
            <!--*************************************-->

        </div>
    </div>
</main>

<!--<footer>-->
<!--    <div class="footer-custom no-print">-->
<!--        <br>-->
<!--        <img-->
<!--                height="25"-->
<!--                src="assets/icongray_0Recurso%205@4x.png" alt="" srcset="">-->
<!--        @Innovación Judicial 2022-->
<!--        <br>-->
<!--        Todos los derechos Reservados-->
<!--    </div>-->
<!--</footer>-->

<!-- ChartJS -->


<!--<script src="sweetalert2.all.min.js"></script>-->

<script src="Chartjs/chart.min.js"></script>
<!--<script src="Chartjs/chart.js"></script>-->
<!--<script src="Chartjs/chart.mjs"></script>-->
<!--<script src="Chartjs/chart.umd.js"></script>-->
<!--<script src="Chartjs/helpers.esm.min.js"></script>-->

<!-- Styles for charts -->
<script src="js/chartStyles.js"></script>

<!-- DCharts development -->
<script src="./config.js"></script>
<script src="js/script.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.26/dist/sweetalert2.all.min.js"
        integrity="sha256-fNaNuEZ0nO4493IejXMa65uBamnI/Hm+iRjgFhfjZBQ=" crossorigin="anonymous"></script>
<script>


    function showSuccessAlerMessaje(titulo, mensaje, action) {
        Swal.fire({
            icon: 'Información',
            title: titulo,
            text: mensaje,
            footer: ''
        })
    }

    function showErrorAlerMessaje(titulo, mensaje, action) {
        Swal.fire({
            icon: 'error',
            title: titulo,
            text: mensaje,
            footer: ''
        })
    }

    comboGrafico = document.getElementById("comboGrafico");

    comboGrafico.addEventListener('change', function (e) {
        var canvas = document.getElementById(idGraficoCurrent)
        canvas.remove()
        const data = {
            labels: currentLabelsGrafico,
            datasets: currentDataGrafico
        };
        var Contentchart7 = document.getElementById("Content" + idGraficoCurrent)
        Contentchart7.innerHTML = ' <canvas id="' + idGraficoCurrent + '"></canvas>'
        if (this.value == "pie") {
            Contentchart7.style.width = "80%"
            currentDataGrafico.forEach(it => {
                it.backgroundColor = [
                    'rgba(255, 99, 132, 0.8)',
                    'rgba(255, 159, 64,0.8)',
                    'rgba(255, 205, 86,0.8)',
                    'rgba(75, 192, 192, 0.8)',
                    'rgba(54, 162, 235,0.8)',
                    'rgba(153, 102, 255,0.8)',
                    'rgba(201, 203, 207, 0.8)',
                ];
                it.borderColor = [
                    'rgb(255, 99, 132)',
                    'rgb(255, 159, 64)',
                    'rgb(255, 205, 86)',
                    'rgb(75, 192, 192)',
                    'rgb(54, 162, 235)',
                    'rgb(153, 102, 255)',
                    'rgb(201, 203, 207)'
                ]
                it.borderWidth = 1;
            })
        } else {
            currentDataGrafico.forEach((it, index) => {
                it.backgroundColor = [
                    styles.color.alphas[index]
                ];
                it.borderColor = [
                    styles.color.solids[index],
                ]
                it.borderWidth = 1;
            })

        }

        let chart = new Chart(idGraficoCurrent,
            {type: this.value, data, currentOptionsGrafico})
    });


    var txtInputdate1Param = document.getElementById("fInicio");
    var txtInputdate2Param = document.getElementById("fFin")

    var txtdate1Param;
    var txtdate2Param;


    setRangoDateDatesInit()

    txtInputdate1Param.addEventListener("change", function () {
        txtdate1Param = txtInputdate1Param.value;
    })
    txtInputdate2Param.addEventListener("change", function () {
        txtdate2Param = txtInputdate2Param.value;
    })


    function setRangoDateDatesInit() {
        let hoy = new Date()
        let mounth = (hoy.getMonth() + 1) < 10 ? "0" + (hoy.getMonth() + 1) : hoy.getMonth() + 1
        let day = (hoy.getDate()) < 10 ? "0" + (hoy.getDate()) : hoy.getDate()
        let ToDate = hoy.getFullYear() + "-" + mounth + "-" + day
        let ToDate12Ago = (hoy.getFullYear() - 1) + "-" + mounth + "-" + day
        // alert("toDate : " + ToDate + " 12ago : " + ToDate12Ago)
        txtInputdate2Param.value = ToDate
        txtInputdate1Param.value = ToDate12Ago
        txtdate1Param = txtInputdate1Param.value;
        txtdate2Param = txtInputdate2Param.value
    }

    var datosItemReporte = {
        position: 0,
        titulo: "",
        htmlItem: "",
    }

    function onCLickItemReporteListenerListener(position, titulo, e) {
        datosItemReporte.position = position
        datosItemReporte.titulo = titulo
        datosItemReporte.htmlItem = e
        spinnerGrafico = document.getElementById("spinnerGrafico");
        mainPanelDiv = document.getElementById("mainPanelDiv");
        spinnerGrafico.style.display = "block"
        mainPanelDiv.style.display = "none"
        var ittulo = document.getElementById("tituloReporte1")
        var ittulo2 = document.getElementById("tituloReporte2")
        var ittulo3 = document.getElementById("tituloReporte3")
        ittulo.innerText = titulo;
        ittulo2.innerText = titulo;
        ittulo3.innerText = titulo;
        var listaItems = document.getElementsByClassName("item-report")
        for (var i = 0; i < listaItems.length; i++) {
            // console.log(listaItems[i])
            listaItems[i].classList.remove("activate");
        }
        e.classList.add("activate");

        let nommbreServicio = "";
        // figure.style.display = "none"
        if (position == 1) {
            nommbreServicio = "getListadoExpIngresos/";
        }
        if (position == 2) {
            nommbreServicio = "getListadoProgramaciones/";
        }
        if (position == 3) {
            nommbreServicio = "getListadoEscritosAnual/";
        }

        // setTimeout(() => {
        fetch(gethostApi() + nommbreServicio + txtdate1Param + "/" + txtdate2Param, {
            method: 'get',
            headers: new Headers({
                'authorization': 'eyJhbGciOiJIUzI1NiJ9.c3VwcmVtYQ.cpUyTYcgm8ixIVDTLe-Fua0RLkyUKg8yy2IkAOfKi2I',
                'Content-Type': 'application/json'
            })
        })
            .then(response => response.json())
            .then(
                (data) => {
                    if (data.length > 0) {
                        printCharts(data, position, titulo)
                        mainPanelDiv.style.display = "block"
                    } else {
                        setRangoDateDatesInit()
                        mainPanelDiv.style.display = "block"
                        spinnerGrafico.style.display = "none"
                        showErrorAlerMessaje("No se encontraron Resultados", "", "")
                    }
                },
                onerror => {
                    setRangoDateDatesInit()
                    mainPanelDiv.style.display = "block"
                    spinnerGrafico.style.display = "none"
                    mainPanelDiv.style.display = "none"
                    showErrorAlerMessaje("Servicio no Disponible", "", "")
                })
        // }, 2000)


    }

    function onClickBuscarListener() {

        var diference = getMonthDifference(new Date(txtdate1Param), new Date(txtdate2Param));
        // alert(diference)
        if (diference <= 12)
            onCLickItemReporteListenerListener(datosItemReporte.position, datosItemReporte.titulo, datosItemReporte.htmlItem)
        else {
            showErrorAlerMessaje(diference + " meses de deferencia", "Rango de Fechas  no validas , debe ingresar un rango menor a 12 meses ", "")
        }

        function getMonthDifference(startDate, endDate) {
            return (
                endDate.getMonth() - startDate.getMonth() + 12 * (endDate.getFullYear() - startDate.getFullYear())
            );
        }
    }


</script>
</body>

</html>
